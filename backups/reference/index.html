<!DOCTYPE html>
<html>

<head>
    <!-- 기본 설정 -->
    <base target="_top">
    
    <!-- 모바일 기기에서의 뷰포트 설정. 사용자의 확대/축소를 막고 앱의 자체 줌 기능을 사용하도록 함. -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- 서버 사이드 함수를 통해 'styles.html' 파일의 내용을 여기에 삽입 -->
    <?!= include('styles'); ?>
</head>

<body>
    <!-- 전체 애플리케이션을 감싸는 컨테이너 -->
    <div class="app-container">

        <!-- 왼쪽 정보 패널 (사이드바) -->
        <aside class="info-panel">
            <!-- 헤더: 앱 제목 및 사용자 정보 -->
            <header class="panel-header">
                <h1>가계도 그리기</h1>
                <!-- Code.gs에서 전달받은 userEmail 변수를 출력 -->
                <p>사용자: <span id="user-email-display"><?= userEmail ?></span></p>
            </header>

            <!-- 섹션 1: 새 가계도 시작 폼 -->
            <section class="form-section">
                <h2 class="section-title">새 가계도 시작</h2>
                <div class="input-group">
                    <label for="tree-name-input">가계도 이름</label>
                    <input type="text" id="tree-name-input" placeholder="예: 우리 가족">
                </div>
                <div class="input-group">
                    <label for="client-name-input">중심인물 이름</label>
                    <input type="text" id="client-name-input" placeholder="이름 입력">
                </div>
                <div class="input-group">
                    <label for="client-birthyear-input">출생연도</label>
                    <input type="number" id="client-birthyear-input" placeholder="예: 1985">
                </div>
                <div class="input-group">
                    <label for="client-gender-select">성별</label>
                    <select id="client-gender-select">
                        <option value="male">남자</option>
                        <option value="female">여자</option>
                    </select>
                </div>
                <button id="start-new-tree-btn" class="btn-primary"><i class="fas fa-play"></i> 새로 시작하기</button>
            </section>

            <!-- 섹션 2: 주변 인물 추가 폼 (초기에는 숨겨짐) -->
            <section id="add-person-section" class="form-section hidden">
                <h2 class="section-title">주변인물 추가</h2>
                <div class="input-group">
                    <label for="center-person-select">기준 인물</label>
                    <select id="center-person-select"></select>
                </div>
                <div class="input-group">
                    <label for="person-name-input">이름</label>
                    <input type="text" id="person-name-input" placeholder="이름 입력">
                </div>
                <div class="input-group">
                    <label for="person-birthyear-input">출생연도</label>
                    <input type="number" id="person-birthyear-input" placeholder="예: 1988 (선택)">
                </div>
                <div class="input-group">
                    <label for="person-gender-select">성별</label>
                    <select id="person-gender-select">
                        <option value="male">남자</option>
                        <option value="female">여자</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="relationship-select">관계</label>
                    <select id="relationship-select">
                        <optgroup label="배우자 관계">
                            <option value="spouse">배우자 (결혼)</option>
                            <option value="divorce">이혼</option>
                            <option value="separation">별거</option>
                            <option value="cohabitant">동거인 (사실혼)</option>
                        </optgroup>
                        <optgroup label="자녀 관계">
                            <option value="child">자녀</option>
                            <option value="adoptedChild">입양 자녀</option>
                            <option value="petChild">반려동물</option>
                        </optgroup>
                        <optgroup label="부모형제">
                            <option value="parent">부모</option>
                            <option value="sibling">형제/자매</option>
                            <option value="identicalMultipleBirth">일란성 다태아</option>
                            <option value="fraternalMultipleBirth">이란성 다태아</option>
                        </optgroup>
                    </select>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="deceased-checkbox">
                    <label for="deceased-checkbox">사망 여부</label>
                </div>
                <button id="add-person-btn" class="btn-primary"><i class="fas fa-user-plus"></i> 인물 추가</button>
            </section>

            <!-- 섹션 3: 저장된 가계도 목록 -->
            <section class="tree-list-section">
                <h2 class="section-title">저장된 가계도 목록</h2>
                <div id="tree-list-container">
                    <p>불러오는 중...</p>
                </div>
                <div class="list-controls">
                    <button id="load-tree-btn" class="btn-secondary"><i class="fas fa-folder-open"></i> 불러오기</button>
                    <button id="delete-tree-btn" class="btn-danger"><i class="fas fa-trash-alt"></i> 선택 삭제</button>
                </div>
            </section>
        </aside>

        <!-- 오른쪽 메인 작업 영역 -->
        <main class="canvas-area">
            <!-- 사이드바가 열렸을 때 캔버스 영역을 덮는 반투명 오버레이 -->
            <div id="sidebar-overlay" class="sidebar-overlay hidden"></div>
            
            <!-- 캔버스 상단 컨트롤 버튼 그룹 -->
            <div class="canvas-controls">
                <div class="control-group">
                    <!-- 모바일 화면에서 사이드바를 열고 닫는 햄버거 버튼 -->
                    <button id="toggle-sidebar-btn" title="메뉴 열기/닫기">
                        <i id="sidebar-icon" class="fas fa-bars"></i>
                        <span class="btn-text">메뉴</span>
                    </button>
                    <button id="save-tree-btn" title="현재 가계도 저장"><i class="fas fa-save"></i> 저장</button>
                    <button id="undo-btn" title="실행 취소"><i class="fas fa-undo"></i> 실행취소</button>
                    <button id="reset-btn" title="캔버스 초기화"><i class="fas fa-eraser"></i> 초기화</button>
                </div>
                <div class="control-group">
                    <button id="save-jpg-btn" title="JPG로 저장"><i class="fas fa-file-image"></i> JPG 저장</button>
                    <button id="save-png-btn" title="PNG로 저장"><i class="fas fa-file-image"></i> PNG 저장</button>
                </div>
            </div>
            
            <!-- 가계도가 그려질 SVG 컨테이너 -->
            <div id="svg-container">
                <svg id="family-tree-svg"></svg>
            </div>
            
            <!-- 하단 상태 표시줄 -->
            <div class="status-bar">
                <span id="status-message">정보를 입력하여 가계도를 그려보세요.</span>
            </div>
        </main>
    </div>

    <!-- 푸터: 제작자 정보 -->
    <footer class="fixed-footer">
        이 가계도는 Google AI Studio를 활용해, <a href="https://welfareact.net" target="_blank" rel="noopener noreferrer">https://welfareact.net</a>에서 제작하였습니다.
    </footer>

    <!-- 로딩 스피너: 서버 통신 등 비동기 작업 시 사용자에게 대기 상태를 알려줌 -->
    <div id="loader" class="hidden">
        <div class="spinner"></div>
    </div>
    
    <!-- 안내 팝업(모달): 개인정보 처리 관련 안내 -->
    <div id="notice-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3>개인정보 처리 안내</h3>
            <p>
                사용자가 입력한 정보는 불러오기 기능을 위해<br>
                스프레드시트 제작자의 계정에 저장됩니다.<br>
                <b>원치 않으시면 만드신 후 '저장된 가계도 목록'에서<br>
                '선택 삭제' 버튼을 눌러 꼭 삭제해 주세요.</b>
            </p>
            <button id="modal-confirm-btn" class="btn-primary">확인했습니다.</button>
        </div>
    </div>

    <!-- 서버 사이드 함수를 통해 'script.html' 파일의 내용을 여기에 삽입 -->
    <?!= include('script'); ?>
</body>

</html>